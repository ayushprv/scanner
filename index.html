<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authe - Confidence in Every Click</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background: #f4f4f4;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .upload-section {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .file-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px dashed #ddd;
            border-radius: 5px;
            text-align: center;
        }
        
        button {
            background: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .results {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-item {
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
        }
        
        .safe {
            background: #d4edda;
            border-left: 5px solid #28a745;
        }
        
        .suspicious {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
        }
        
        .malicious {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
        }
        
        .bank-list {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .bank-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background: #e9ecef;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            color: #28a745;
            background: #d4edda;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .progress {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ°Ô∏è Authe</h1>
        <p>Confidence in Every Click</p>
        <small>APK Security Checker for Banking Apps</small>
    </div>

    <div class="container">
        <!-- Supported Banks -->
        <div class="bank-list">
            <h3>üè¶ Commonly Checked Banking Apps</h3>
            <p>We help verify APKs for major banking institutions:</p>
            <div style="margin-top: 15px;">
                <span class="bank-item">State Bank of India (SBI)</span>
                <span class="bank-item">Bank of Baroda (BOB)</span>
                <span class="bank-item">HDFC Bank</span>
                <span class="bank-item">ICICI Bank</span>
                <span class="bank-item">Axis Bank</span>
                <span class="bank-item">Punjab National Bank</span>
                <span class="bank-item">Canara Bank</span>
                <span class="bank-item">Union Bank</span>
                <span class="bank-item">Bank of India</span>
                <span class="bank-item">IDBI Bank</span>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
            <h3>üì± Upload APK File for Analysis</h3>
            <div class="file-input" id="dropZone">
                <p>Drag and drop your APK file here or click to browse</p>
                <input type="file" id="fileInput" accept=".apk" style="display: none;">
                <button onclick="document.getElementById('fileInput').click()">Choose File</button>
            </div>
            <div id="fileInfo" style="margin-top: 15px;"></div>
            <button id="scanButton" onclick="scanFile()" disabled>üîç Scan APK</button>
            <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>

        <!-- Loading Section -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing APK file...</p>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <p id="statusText">Uploading file...</p>
        </div>

        <!-- Results Section -->
        <div class="results" id="results" style="display: none;">
            <h3>üìä Scan Results</h3>
            <div id="scanResults"></div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        const API_BASE_URL = '/api'; // This will be our backend API

        // File handling
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const scanButton = document.getElementById('scanButton');

        fileInput.addEventListener('change', handleFileSelect);
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('drop', handleFileDrop);

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file && file.name.endsWith('.apk')) {
                selectedFile = file;
                displayFileInfo(file);
                scanButton.disabled = false;
            } else {
                showMessage('Please select a valid APK file', 'error');
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            dropZone.style.borderColor = '#3498db';
        }

        function handleFileDrop(e) {
            e.preventDefault();
            dropZone.style.borderColor = '#ddd';
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.apk')) {
                selectedFile = file;
                displayFileInfo(file);
                scanButton.disabled = false;
            } else {
                showMessage('Please drop a valid APK file', 'error');
            }
        }

        function displayFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            fileInfo.innerHTML = `
                <div class="success">
                    <strong>üìÅ File Selected:</strong> ${file.name}<br>
                    <strong>üìè Size:</strong> ${fileSize} MB<br>
                    <strong>üìÖ Modified:</strong> ${new Date(file.lastModified).toLocaleString()}
                </div>
            `;
        }

        // Main scanning function
        async function scanFile() {
            if (!selectedFile) {
                showMessage('Please select an APK file first', 'error');
                return;
            }

            try {
                showLoading(true);
                updateProgress(10, 'Uploading file...');

                // Upload file to our backend
                const formData = new FormData();
                formData.append('file', selectedFile);

                const uploadResponse = await fetch(`${API_BASE_URL}/scan`, {
                    method: 'POST',
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error(`Upload failed: ${uploadResponse.status}`);
                }

                const uploadResult = await uploadResponse.json();
                const scanId = uploadResult.scanId;
                
                updateProgress(30, 'File uploaded, starting analysis...');
                
                // Poll for results
                await pollForResults(scanId);
                
            } catch (error) {
                console.error('Scan error:', error);
                showMessage(`Scan failed: ${error.message}`, 'error');
                showLoading(false);
            }
        }

        async function pollForResults(scanId) {
            let attempts = 0;
            const maxAttempts = 30;
            
            while (attempts < maxAttempts) {
                try {
                    updateProgress(30 + (attempts * 2), `Analyzing... (${attempts + 1}/${maxAttempts})`);
                    
                    const response = await fetch(`${API_BASE_URL}/results/${scanId}`);
                    const result = await response.json();

                    if (result.status === 'completed') {
                        updateProgress(100, 'Analysis complete!');
                        setTimeout(() => {
                            showLoading(false);
                            displayResults(result.data);
                        }, 500);
                        return;
                    } else if (result.status === 'processing') {
                        await new Promise(resolve => setTimeout(resolve, 10000));
                        attempts++;
                    } else if (result.status === 'error') {
                        throw new Error(result.message || 'Analysis failed');
                    }
                } catch (error) {
                    console.error('Polling error:', error);
                    attempts++;
                    if (attempts >= maxAttempts) {
                        throw new Error('Analysis timeout. Please try again later.');
                    }
                    await new Promise(resolve => setTimeout(resolve, 10000));
                }
            }
            
            throw new Error('Analysis timeout. The file is taking too long to process.');
        }

        function displayResults(scanResult) {
            const resultsDiv = document.getElementById('results');
            const scanResultsDiv = document.getElementById('scanResults');
            
            const positives = scanResult.positives || 0;
            const total = scanResult.total || 0;
            const percentage = total > 0 ? ((positives / total) * 100).toFixed(1) : 0;
            
            let riskLevel = 'safe';
            let riskText = 'Clean';
            let riskIcon = '‚úÖ';
            
            if (positives > 0 && positives <= 3) {
                riskLevel = 'suspicious';
                riskText = 'Low Risk';
                riskIcon = '‚ö†Ô∏è';
            } else if (positives > 3) {
                riskLevel = 'malicious';
                riskText = 'High Risk';
                riskIcon = '‚ùå';
            }

            scanResultsDiv.innerHTML = `
                <div class="result-item ${riskLevel}">
                    <h4>${riskIcon} Scan Summary</h4>
                    <p><strong>Risk Level:</strong> ${riskText}</p>
                    <p><strong>Detection Rate:</strong> ${positives}/${total} (${percentage}%)</p>
                    <p><strong>File:</strong> ${selectedFile.name}</p>
                    <p><strong>MD5:</strong> ${scanResult.md5 || 'N/A'}</p>
                    <p><strong>SHA1:</strong> ${scanResult.sha1 || 'N/A'}</p>
                    <p><strong>Scan Date:</strong> ${scanResult.scan_date || 'N/A'}</p>
                </div>

                <div class="result-item">
                    <h4>üîç Detailed Detection Results</h4>
                    <div id="detectionDetails"></div>
                </div>

                <div class="result-item">
                    <h4>üí° Recommendations</h4>
                    <div id="recommendations"></div>
                </div>
            `;

            displayDetectionDetails(scanResult.scans || {});
            displayRecommendations(riskLevel, positives);
            
            resultsDiv.style.display = 'block';
        }

        function displayDetectionDetails(scans) {
            const detailsDiv = document.getElementById('detectionDetails');
            let detailsHtml = '<div style="max-height: 300px; overflow-y: auto;">';
            
            Object.entries(scans).forEach(([engine, result]) => {
                const detected = result.detected;
                const malware = result.result || 'Clean';
                const statusClass = detected ? 'malicious' : 'safe';
                const statusIcon = detected ? '‚ùå' : '‚úÖ';
                
                detailsHtml += `
                    <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee;">
                        <span><strong>${engine}:</strong></span>
                        <span class="${statusClass}">${statusIcon} ${malware}</span>
                    </div>
                `;
            });
            
            detailsHtml += '</div>';
            detailsDiv.innerHTML = detailsHtml;
        }

        function displayRecommendations(riskLevel, positives) {
            const recommendationsDiv = document.getElementById('recommendations');
            let recommendations = '';
            
            switch (riskLevel) {
                case 'safe':
                    recommendations = `
                        <p style="color: #28a745;">‚úÖ This APK appears to be clean and safe to install.</p>
                        <p>‚Ä¢ Always download banking apps from official sources (Google Play Store, bank's official website)</p>
                        <p>‚Ä¢ Verify the app publisher matches the official bank name</p>
                        <p>‚Ä¢ Keep your apps updated to the latest version</p>
                    `;
                    break;
                    
                case 'suspicious':
                    recommendations = `
                        <p style="color: #ffc107;">‚ö†Ô∏è This APK has been flagged by ${positives} security engine(s). Exercise caution.</p>
                        <p>‚Ä¢ Do not install this APK from untrusted sources</p>
                        <p>‚Ä¢ Download the official app from Google Play Store instead</p>
                        <p>‚Ä¢ Contact your bank to verify the authenticity of the app</p>
                        <p>‚Ä¢ Consider the detections might be false positives, but prioritize safety</p>
                    `;
                    break;
                    
                case 'malicious':
                    recommendations = `
                        <p style="color: #dc3545;">‚ùå This APK is highly suspicious and potentially dangerous.</p>
                        <p>‚Ä¢ DO NOT install this APK under any circumstances</p>
                        <p>‚Ä¢ Delete the file immediately from your device</p>
                        <p>‚Ä¢ Only download banking apps from Google Play Store</p>
                        <p>‚Ä¢ Report this file to your bank's cybersecurity team</p>
                        <p>‚Ä¢ Run a full antivirus scan on your device</p>
                    `;
                    break;
            }
            
            recommendationsDiv.innerHTML = recommendations;
        }

        // Utility functions
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            if (!show) {
                updateProgress(0, '');
            }
        }

        function updateProgress(percentage, statusText) {
            const progressBar = document.getElementById('progressBar');
            const statusElement = document.getElementById('statusText');
            
            progressBar.style.width = percentage + '%';
            statusElement.textContent = statusText;
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.right = '20px';
            messageDiv.style.zIndex = '1000';
            messageDiv.style.padding = '15px';
            messageDiv.style.borderRadius = '5px';
            messageDiv.style.maxWidth = '300px';
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        function clearResults() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('fileInfo').innerHTML = '';
            selectedFile = null;
            scanButton.disabled = true;
            fileInput.value = '';
            showMessage('Results cleared', 'success');
        }

        function showSecurityTips() {
            alert(`
üîí Banking App Security Tips:

1. Always download apps from Google Play Store
2. Verify the publisher name matches your bank
3. Check app permissions before installing
4. Keep apps updated to latest versions
5. Never download APK files from unknown sources
6. Use official bank websites or branches for support
7. Enable two-factor authentication when available
8. Regularly monitor your account for suspicious activity
            `);
        }
    </script>
    
    <div style="text-align: center; margin: 2rem 0; padding: 2rem; background: white; border-radius: 10px;">
        <h3>üîí Security Tips</h3>
        <button onclick="showSecurityTips()" style="background: #28a745;">View Security Guidelines</button>
        <p style="margin-top: 15px; color: #666; font-size: 14px;">
            Always prioritize your financial security. When in doubt, contact your bank directly.
        </p>
    </div>
</body>
</html>
